{{ $headers := findRE "<h2.*?>(.|\n])+?</h2>" .Content }}
{{ $hasHeader := ge (len $headers) 1 }}
{{ $permalink := .Permalink }}
<div class="table-of-contents">
	<h1 class="table-of-contents__title">
		{{ .Page.CurrentSection.Title }}
	</h1>
	<ul>
		{{ range (where .Site.RegularPages "Section" .CurrentSection.Section).ByWeight }}
			{{if (eq .Permalink $permalink | and $hasHeader)}}
				<li class="table-of-contents__item"><a href="{{ .Permalink }}" class="on">{{ .Title }}</a></li>
				{{ range $header := $headers }}
					{{ $name := ($header | plainify) }}
					{{ $id := htmlEscape $header | replaceRE "^.+id=&#34;(.+)&#34;.+$" "$1" }}
					{{ $url := delimit ( slice "#" $id) "" }}
					<li class="table-of-contents__item table-of-contents__item--sub">
						<a class="table-of-contents__link" href="{{ $url }}">
							{{ htmlUnescape $name }}
						</a>
					</li>
				{{ end }}
			{{ else }}
				<li class="table-of-contents__item">
					<a class="table-of-contents__link" href="{{ .Permalink }}">
						{{ .Title }}
					</a>
				</li>
			{{ end }}
		{{ end }}
	</ul>
</div>
